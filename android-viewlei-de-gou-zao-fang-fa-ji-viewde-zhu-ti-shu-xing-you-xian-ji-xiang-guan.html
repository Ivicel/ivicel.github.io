<!DOCTYPE html>
<html lang="zh" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Android View类的构造方法及View的主题属性优先级相关 - Amber time</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="./android-viewlei-de-gou-zao-fang-fa-ji-viewde-zhu-ti-shu-xing-you-xian-ji-xiang-guan.html">

        <meta name="author" content="ivicel" />
        <meta name="keywords" content="view,构造方法,attrs,declare-styleable,style" />
        <meta name="description" content="1. layout 里 view 的属性赋值 一个 layout 文件里的 view 的属性可以在 5 个地方赋值, 优先级从高到低如下: layout 中对属性直接赋值 layout 中覆盖 view 的 style 构造方法里的 defStyleAttr 构造方法里的 defStyleRes, 这个当仅当 defStyleAttr 值为 0 , 或者其指定的 attr 值找不到(比如没设定) 定义/使用的主题里的值 在 layout 布局文件里对 view 直接赋值 xml &lt;TextView android:textColor=&#34;#332211&#34;/&gt; 自定义一个 style, 然后在 layout 里的 view …" />

        <meta property="og:site_name" content="Amber time" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Android View类的构造方法及View的主题属性优先级相关"/>
        <meta property="og:url" content="./android-viewlei-de-gou-zao-fang-fa-ji-viewde-zhu-ti-shu-xing-you-xian-ji-xiang-guan.html"/>
        <meta property="og:description" content="1. layout 里 view 的属性赋值 一个 layout 文件里的 view 的属性可以在 5 个地方赋值, 优先级从高到低如下: layout 中对属性直接赋值 layout 中覆盖 view 的 style 构造方法里的 defStyleAttr 构造方法里的 defStyleRes, 这个当仅当 defStyleAttr 值为 0 , 或者其指定的 attr 值找不到(比如没设定) 定义/使用的主题里的值 在 layout 布局文件里对 view 直接赋值 xml &lt;TextView android:textColor=&#34;#332211&#34;/&gt; 自定义一个 style, 然后在 layout 里的 view …"/>
        <meta property="article:published_time" content="2018-04-22" />
            <meta property="article:section" content="Android" />
            <meta property="article:tag" content="view" />
            <meta property="article:tag" content="构造方法" />
            <meta property="article:tag" content="attrs" />
            <meta property="article:tag" content="declare-styleable" />
            <meta property="article:tag" content="style" />
            <meta property="article:author" content="ivicel" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="./theme/css/bootstrap.min.css" type="text/css"/>
    <link href="./theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="./theme/css/pygments/emacs.css" rel="stylesheet">
    <link rel="stylesheet" href="./theme/css/style.css" type="text/css"/>
        <link href="./theme/css/custom.css" rel="stylesheet">





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="./" class="navbar-brand">
Amber time            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="./category/android.html">Android</a>
                        </li>
                        <li >
                            <a href="./category/c-language.html">C language</a>
                        </li>
                        <li >
                            <a href="./category/data-structure-algorithms.html">Data structure algorithms</a>
                        </li>
                        <li >
                            <a href="./category/database.html">Database</a>
                        </li>
                        <li >
                            <a href="./category/java.html">Java</a>
                        </li>
                        <li >
                            <a href="./category/javascript.html">Javascript</a>
                        </li>
                        <li >
                            <a href="./category/python.html">Python</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="./android-viewlei-de-gou-zao-fang-fa-ji-viewde-zhu-ti-shu-xing-you-xian-ji-xiang-guan.html"
                       rel="bookmark"
                       title="Permalink to Android View类的构造方法及View的主题属性优先级相关">
                        Android View类的构造方法及View的主题属性优先级相关
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2018-04-22T00:00:00+08:00"> Sun 22 April 2018</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="./tag/view.html">view</a>
        /
	<a href="./tag/gou-zao-fang-fa.html">构造方法</a>
        /
	<a href="./tag/attrs.html">attrs</a>
        /
	<a href="./tag/declare-styleable.html">declare-styleable</a>
        /
	<a href="./tag/style.html">style</a>
        
</footer><!-- /.post-info -->                    </div>
                </div>
                <h3 id="1-layout-view">1. layout 里 view 的属性赋值</h3>
<p>一个 layout 文件里的 view 的属性可以在 5 个地方赋值, 优先级从高到低如下:</p>
<ul>
<li>layout 中对属性直接赋值  </li>
<li>layout 中覆盖 view 的 style </li>
<li>构造方法里的 defStyleAttr </li>
<li>构造方法里的 defStyleRes, 这个当仅当 defStyleAttr 值为 0 , 或者其指定的 attr 值找不到(比如没设定)</li>
<li>定义/使用的主题里的值 </li>
</ul>
<ol>
<li>在 <strong>layout</strong> 布局文件里对 view 直接赋值</li>
</ol>
<p><code>xml
   &lt;TextView
    android:textColor="#332211"/&gt;</code></p>
<ol>
<li>自定义一个 <code>style</code>, 然后在 <code>layout</code> 里的 <code>view</code> 使用 <code>style</code> 属性来覆盖. </li>
</ol>
<p>影响该 <code>view</code> 以及其子 <code>view</code>. 只有 <code>view</code> 有对应属性时才进行替换</p>
<p>```xml
   <style name="MyTextStyle">
       <item name="android:textColor">
   </style>
   <!-- 直接对 view 使用 -->
   <TextView
    style="@style/MyTextStyle"/>
   <!-- 对 ViewGroup 使用, 影响子 view -->
   <LinearLayout
    style="@style/MyTextStyle"></p>
<div class="highlight"><pre><span></span>&lt;TextView
    android:text=&quot;inherit from ViewGroup textColor&quot;/&gt;

   &lt;!-- 没有 textColor 属性, 无影响 --&gt;
   &lt;ImageView
    android:src=&quot;@drawable/welcome.png&quot;/&gt;
</pre></div>


<p></LinearLayout></p>
<p>```</p>
<ol>
<li>Default Style Attribute (defStyleAttr)</li>
</ol>
<p>在 <code>TextView</code> 的源代码里有一个构造方法是这样的</p>
<p><code>java
   public TextView(Context context, @Nullable AttributeSet attrs) {
       this(context, attrs, com.android.internal.R.attr.textViewStyle);
   }</code></p>
<p><code>com.android.internal.R.attr.textViewStyle</code> 是一个 frameworks 层定义的 <a href="https://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/core/res/res/values/attrs.xml">attr</a>. </p>
<p><code>xml
   &lt;resources&gt;
       &lt;!-- These are the standard attributes that make up a complete theme. --&gt;
       &lt;declare-styleable name="Theme"&gt;
           &lt;!-- ... --&gt;
           &lt;!-- Default TextView style. --&gt;
           &lt;attr name="textViewStyle" format="reference" /&gt;
           &lt;!-- .... --&gt;
    &lt;declare-styleable&gt;
   &lt;/resources&gt;</code></p>
<p>可以看到这个 attr 类型是一个引用, 所以当我们这样定义一个 style item 时</p>
<p>```xml
   <style name="AppTheme" parent="Theme.AppCompat.Light.DarkActionBar">
       <item name="android:textColor">@android:color/holo_green_dark</item>
       <!-- 由于 defStyleAttr 的优先级比主题的高, 
        所以 textColor 被覆盖为 holo_blue_light, 即使上面定义了 textColor
    -->
       <item name="android:textViewStyle">@style/BlueTextStyle</item>
   </style></p>
<p><style name="BlueTextStyle">
       <item name="android:textColor">@android:color/holo_blue_light</item>
   </style>
   ```</p>
<ol>
<li>Default Style Resource (defStyleRes)</li>
</ol>
<p>构造方法 <code>public View(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes)</code> 是在 SDK 21 之后才有的, 但 defStyleRes 的值是早之前就有使用的. 这个是一个 <code>R.style.[name]</code> 值, 只有当 defStyleAttr 为 0 或者查找不到时才有效</p>
<blockquote>
<p>需要注意的是, <code>defStyleAttr</code> 里要求的是一个 format="reference" 的 attr, 但其实质上是一个整型值, 并且代码中没有用 @AttrRes 来注释, 所以随便传一个整型值时, 便可能是相当于 defStyleAttr 不存在. 同理 <code>defStyleRes</code> 要求的是一个 style id</p>
</blockquote>
<ol>
<li>在主题文件里赋值, 比如我们在 <code>styles.xml</code> 里自定义了一个主题 <code>AppTheme</code>. </li>
</ol>
<p>这个主题可以在 <code>activity</code> 里覆盖, 也可以设置为程序的默认主题</p>
<p>``` xml
   <!--比如我们在 styles.xml 里自定义一个主题, 覆盖 andorid:textColor 后, 
    使用该主题的 view 中有 android:textColor 这个属性的会使用我们设定的值
    因为我们定义的是一个应用的主题, 而不是单独某个 view 下的某些个属性
    所以这个主题需要继承系统的主题, 然后再覆盖, 下面继承的是 support 包里的兼容主题
    -->
   <style name="AppTheme" parent="Theme.AppCompat.Light.DarkActionBar">
       <item name="android:textColor">@color/myTextColor</item>
   </style></p>
<p><!-- 设置好一个程序的主题文件后, 我们可以在 AndroidManifest.xml 中引用 -->
   <!-- 应用全局主题 -->
   <application
    android:theme="@style/AppTheme"/></p>
<p><!-- 在 activity 配置里引用, 这会覆盖掉全局 application 里的设置 -->
   <activity
    android:theme="@style/AppTheme"/>
   ```</p>
<h3 id="2">2. 构造方法介绍</h3>
<p>以 SDK 27 中的 <code>ImageView</code> 为例, 一共有 4 个构造方法, 如下</p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="nf">ImageView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="n">initImageView</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="nf">ImageView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="nf">ImageView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">defStyleAttr</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="n">defStyleAttr</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="nf">ImageView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">defStyleAttr</span><span class="o">,</span>
        <span class="kt">int</span> <span class="n">defStyleRes</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="n">defStyleAttr</span><span class="o">,</span> <span class="n">defStyleRes</span><span class="o">);</span>
    <span class="cm">/* .... */</span>
<span class="o">}</span>
</pre></div>


<p>构造方法最多有 4 个参数, 简单意思如下:</p>
<ul>
<li><code>context</code> 每个构造方法都有, 用来 inflate, 获取各种参数值等. 如果我们从 Java 代码中直接创建一个新的 view, 一般都是使用只有 context 的参数的构造方法</li>
<li><code>attrs</code> 这个是对布局文件 layout.xml 里的解析后生成的对象, 可以获取到 xml 里的配置</li>
<li><code>defStyleAttr</code> 属性引用</li>
<li><code>defStyleRes</code> SDK 21 后增加的. 如果 minSdkVersion &gt; 21 时才使用这个参数. 不然使用 <code>Theme#obtainStyledAttributes()</code> 也可以解析</li>
</ul>
<p>在 View inflate 后, 其所以设置属性都解析到了参数 attrs 中. 可以通过 <code>AttributeSet#getAttributeName()</code>, <code>AttributeSet#getAttributeValue()</code> 来获得名称和值. 但这个获得的只能是直接的值, 如果像 <code>android:text=@string/name"</code> 这样引用, android 内部都是通过 id 来查找, 所以也是获得一个 id 值, 所以我们总是用 <code>Theme</code> 类里的方法来一步解析, 这样可以直接找到对应的 string 值而不是 id</p>
<blockquote>
<p><code>Context</code> 中也有对应的方法, 其实质是调用了 context.getTeme.obtainStyledAttributes 而已</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="c1">// 从解析好的 AttributeSet 查找</span>
<span class="n">TypedArray</span> <span class="nf">obtainStyledAttributes</span><span class="o">(</span><span class="n">AttributeSet</span> <span class="n">set</span><span class="o">,</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">attrs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">defStyleAttr</span><span class="o">,</span> 
        <span class="kt">int</span> <span class="n">defStyleRes</span><span class="o">)</span>
<span class="c1">// 从主题中查找</span>
<span class="n">TypedArray</span> <span class="nf">obtainStyledAttributes</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">attrs</span><span class="o">)</span>
<span class="c1">// 从指定的资源文件查找</span>
<span class="n">TypedArray</span> <span class="nf">obtainStyledAttributes</span><span class="o">(</span><span class="kt">int</span> <span class="n">resId</span><span class="o">,</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">attrs</span><span class="o">)</span>
</pre></div>


<h3 id="reference">Reference:</h3>
<ol>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2016/0806/4575.html">http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2016/0806/4575.html</a></li>
<li><a href="https://blog.csdn.net/nbalichaoq/article/details/50550103">https://blog.csdn.net/nbalichaoq/article/details/50550103</a></li>
</ol>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
        <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="#"><i class="fa fa-you-can-add-links-in-your-config-file-square fa-lg"></i> You can add links in your config file</a></li>
                <li class="list-group-item"><a href="#"><i class="fa fa-another-social-link-square fa-lg"></i> Another social link</a></li>
              </ul>
            </li>





    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://getpelican.com/" target="_blank">
                Pelican
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://python.org/" target="_blank">
                Python.org
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://jinja.pocoo.org/" target="_blank">
                Jinja2
            </a>
        </li>
        <li class="list-group-item">
            <a href="#" target="_blank">
                You can modify those links in your config file
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 ivicel
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="./theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="./theme/js/respond.min.js"></script>


</body>
</html>